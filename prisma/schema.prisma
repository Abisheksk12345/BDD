generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* ===============================
   USER MODEL
================================ */
model User {
  id         Int        @id @default(autoincrement())
  email      String     @unique
  password   String
  role       GlobalRole @default(USER)

  projectId  String?
  project    Project?   @relation(fields: [projectId], references: [id])

  members    Member[]
  staff      Staff[]

  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @default(now()) @updatedAt
}

enum GlobalRole {
  SUPERADMIN
  USER
}

/* ===============================
   STAFF MODEL
================================ */
model Staff {
  id            String     @id @default(uuid())

  userId        Int?
  user          User?      @relation(fields: [userId], references: [id])

  teamId        String?
  team          Team?      @relation(fields: [teamId], references: [id])

  memberId      String?
  member        Member?    @relation(fields: [memberId], references: [id])

  // Project owner relation
  ownedProjects Project[]  @relation("ProjectOwner")

  // staff assigned to project
  projectId     String?
  project       Project?    @relation(fields: [projectId], references: [id])

  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @default(now()) @updatedAt
}

/* ===============================
   PROJECT MODEL
================================ */
model Project {
  id          String          @id @default(uuid())
  name        String
  key         String?         @unique
  type        ProjectType?
  status      ProjectStatus?
  description String?

  startDate   DateTime?
  endDate     DateTime?

  template    String?

  // Project Owner
  ownerId     String?
  owner       Staff?          @relation("ProjectOwner", fields: [ownerId], references: [id])

  users       User[]
  features    Feature[]
  teams       Team[]
  staff       Staff[]

  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @default(now()) @updatedAt
}

enum ProjectType {
  INTERNAL
  CLIENT
  MAINTENANCE
  RESEARCH
}

enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

/* ===============================
   FEATURE MODEL
================================ */
model Feature {
  id          String     @id @default(uuid())
  name        String
  description String?

  projectId   String
  project     Project    @relation(fields: [projectId], references: [id])

  scenarios   Scenario[]
   order       Int      @default(0)   // feature order

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @default(now()) @updatedAt
}

/* ===============================
   SCENARIO MODEL
================================ */
model Scenario {
  id          String     @id @default(uuid())
  name        String
  description String?

  featureId   String
  feature     Feature    @relation(fields: [featureId], references: [id])

  // JSON step array
  testSteps   Json       @default("[]")
    order       Int      @default(0)   // scenario order
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @default(now()) @updatedAt
}

/* ===============================
   TEAM MODEL
================================ */
model Team {
  id          String     @id @default(uuid())
  name        String
  description String?

  projectId   String
  project     Project     @relation(fields: [projectId], references: [id])

  members     Member[]
  staff       Staff[]

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @default(now()) @updatedAt
}

/* ===============================
   MEMBER MODEL
================================ */
model Member {
  id        String     @id @default(uuid())
  teamId    String
  team      Team       @relation(fields: [teamId], references: [id])

  userId    Int?
  user      User?      @relation(fields: [userId], references: [id])

  fullName  String
  email     String
  role      MemberRole @default(TEAM_LEAD)

  staff     Staff[]

  createdAt DateTime   @default(now())
  updatedAt DateTime   @default(now()) @updatedAt
}

enum MemberRole {
  TEAM_LEAD
  PROJECT_MANAGER
  FRONTEND_DEVELOPER
  BACKEND_DEVELOPER
  FULLSTACK_DEVELOPER
  UI_UX_DESIGNER
  QA_TESTER
  BUSINESS_ANALYST
  OTHER
}
